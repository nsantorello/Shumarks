<% form_for :link, :url => link_save_url, :method => 'POST' do |f| -%>
	<div class="form-label">
		<label for="url">Url: </label>
	</div>
	<div class="form-input-error-list">
		<%= errors_for(@link, :url) %>
	</div>
  <div class="form-input">
  	<%= f.text_field :url, :class => 'top-corners bottom-corners', :value => @link.url %>
  </div>
	<div class="form-label">
		<label for="name">Title: </label>
	</div>
	<div class="form-input-error-list">
		<%= errors_for(@link, :name) %>
	</div>
  <div class="form-input">
  	<%= f.text_field :name, :class => 'top-corners bottom-corners', :value => @link.name %>
  </div>
	<div class="form-label">
		<label for="blurb">Blurb: </label>
	</div>
	<div class="form-input-error-list">
		<%= errors_for(@link, :blurb) %>
	</div>
  <div class="form-input">
  	<%= f.text_area :blurb, :class => 'top-corners bottom-corners', :value => @link.blurb %>
  </div>
	<div class="form-input">
		<p id="fb-integrationpoint"></p>
		<div id="fb-root"></div>
	    <script>
	      window.fbAsyncInit = function() {
			// Initialize Facebook JavaScript SDK.
	        FB.init({appId: '160338477351298', status: true, cookie: true, xfbml: true});
	
			function showFBIntegration()
			{
				FB.api('/me', function(response) {
				  	jQuery('#fb-integrationpoint').empty();
					jQuery('#fb-integrationpoint').append('<input type="checkbox" name="post-fb" value="true" checked /> Post this link on Facebook as <strong>' + response.name + '</strong> <fb:profile-pic uid="' + response.id + '" linked="false" size="t" width="25" height="25"></fb:profile-pic> <span style="font-size:10px">(<a href="javascript:FB.logout();">Not you?</a>)</span>');
					FB.XFBML.parse(document.getElementById('fb-integrationpoint'));
				});
			}
			
			function showFBLogin()
			{
				jQuery('#fb-integrationpoint').empty();
				jQuery('#fb-integrationpoint').prepend('<div style="font-weight:bold">You must log into Facebook to enable Shumarks integration.</div><div style="font-size:10px">(Shumarks will <strong>NEVER</strong> post <strong>ANYTHING</strong> to Facebook without asking you.)<fb:login-button autologoutlink="true" perms="publish_stream"></fb:login-button>');
				FB.XFBML.parse(document.getElementById('fb-integrationpoint'));
			}
	
			// If user is logged in, display the option to post to FB.  Otherwise display the login button.
			FB.getLoginStatus(function(response) {
			  if (response.session) {
				// User session data available, so show option to post to FB.
				showFBIntegration();
			  } else {
				// No user session data available, so show login button.
			    showFBLogin();
			  }
			});
			
			FB.Event.subscribe('auth.login', function(response) {
			  showFBIntegration();
			});
			
			FB.Event.subscribe('auth.logout', function(response) {
			  showFBLogin();
			});
	      };
	    </script>
		<script>
		
		</script>
	</div>
	<br />
	<div class="form-submit clear-both">
		<%= submit_tag 'Shumark it!', :class => "small-button" %>
	</div>
<% end %>